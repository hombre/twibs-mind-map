'use strict';var TwibsMindMaps;
(function(q){class r{constructor(g){this.ideasMap=new Map;this.ideasByElement=new Map;this.ideasByShadow=new Map;this.ideas=()=>[...this.ideasMap.values()];this.load=a=>this.fromModels(JSON.parse(a));this.fromModels=a=>this.undoable(()=>a.forEach(a=>this.add(a)));this.save=()=>JSON.stringify(this.toModels());this.toModels=()=>this.ideas().map(a=>a.toModel());this.add=a=>{const b=new t(this);b.update(a);this.ideasMap.set(a.id,b);return b};this.remove=a=>{const b=this.ideasMap.get(a);b&&b.remove();
this.ideasMap.delete(a)};this.update=a=>this.ideasMap.get(a.id).update(a);this.createModel=(a,b,c="",e="",n=new d(0,0),l=!1,f=!1,h=!1)=>({id:a,parentId:b,title:c,key:e,x:n.x,y:n.y,selected:l,marked:f,collapsed:h});this.isMarking=this.isEditing=!0;this.onChanged=a=>{};this.undoActions=[];this.redoActions=[];this.ur=(a,b)=>({undo:a,redo:b});this.AddUR=a=>this.ur(()=>this.remove(a.id),()=>this.add(a));this.RemoveUR=a=>this.ur(()=>this.add(a),()=>this.remove(a.id));this.UpdateUR=(a,b)=>this.ur(()=>this.update(a),
()=>this.update(b));this.undoable=a=>{const b=this.toModels();a();this.redraw(!0);this.storeUndoRedo(b);this.updateButtons();this.onChanged(this)};this.storeUndoRedo=a=>{const b=[];a=a.sort((a,b)=>a.id-b.id);const c=this.ideas().map(a=>a.toModel()).sort((a,b)=>a.id-b.id);for(;0<a.length||0<c.length;)0==a.length?(b.push(...c.map(a=>this.AddUR(a))),c.length=0):0==c.length?(b.push(...a.map(a=>this.RemoveUR(a))),a.length=0):a[0].id<c[0].id?b.push(this.RemoveUR(a.shift())):a[0].id>c[0].id?b.push(this.AddUR(a.shift())):
b.push(this.UpdateUR(a.shift(),c.shift()));0<b.length&&(this.undoActions.push(b),this.redoActions.length=0)};this.clearUndoRedo=()=>{this.undoActions.length=0;this.redoActions.length=0;this.updateButtons()};this.canUndo=()=>0<this.undoActions.length;this.undo=()=>{if(this.canUndo()){this.blur();const a=this.undoActions.pop();this.redoActions.push(a);a.forEach(a=>a.undo());this.changed(!0)}};this.canRedo=()=>0<this.redoActions.length;this.redo=()=>{if(this.canRedo()){this.blur();const a=this.redoActions.pop();
this.undoActions.push(a);a.forEach(a=>a.redo());this.changed(!0)}};this.buttons=[];this.updateButtons=()=>this.buttons.forEach(a=>a.update());this.attachButtons=a=>{function b(b,d,l){a.querySelectorAll(`button[data-tmm=${b}]`).forEach(a=>{if(a instanceof HTMLButtonElement){a.addEventListener("click",l);a.addEventListener("mousedown",a=>a.preventDefault());const b={update:()=>a.disabled=!d()};c.buttons.push(b);b.update()}})}if(null!=a){var c=this;b("undo",this.canUndo,this.undo);b("redo",this.canRedo,
this.redo);b("expand",this.canExpand,this.expand);b("collapse",this.canCollapse,this.collapse);b("scale-up",this.canScaleUp,this.scaleUp);b("scale-down",this.canScaleDown,this.scaleDown);b("add-sibling",this.canAddSibling,this.addSibling);b("add-child",this.canAddChild,this.addChild);b("remove",this.canRemove,this.removeSelected);b("mark",this.canMark,this.mark);b("fit-to-container",this.canFitToContainer,this.fitToContainer);b("layout",this.canLayout,()=>this.layout(!0));this.updateButtons()}};this.scale=
1;this.updateScale=a=>{this.scale=Math.round(100*Math.max(.1,a))/100;this.mm.style.transform=`scale(${this.scale})`;this.redraw(!1);window.localStorage.setItem("tmm.scale",""+this.scale)};this.displaySize=()=>(new d(this.container.offsetWidth,this.container.offsetHeight)).divide(this.scale);this.canScaleUp=()=>!0;this.scaleUp=()=>this.updateScale(1.5*this.scale);this.canScaleDown=()=>!0;this.scaleDown=()=>this.updateScale(this.scale/1.5);this.canFitToContainer=()=>0<this.ideas().length;this.fitToContainer=
()=>{if(this.canFitToContainer()){var a=1<this.ideas().length?this.ideas().reduce((a,c)=>c.rect().union(a),this.ideas()[0].rect()):this.ideas()[0].rect();this.moveRootIdeas(new d(-a.center.x,-a.center.y));a=new d(a.width+80,a.height+80);this.updateScale(Math.min(this.container.offsetWidth/a.x,this.container.offsetHeight/a.y))}};this.initResizeObserver=()=>{function a(){if(e.container.offsetWidth!=b||e.container.offsetHeight!=c)b=e.container.offsetWidth,c=e.container.offsetHeight,e.redraw(!1)}let b=
this.container.offsetWidth,c=this.container.offsetHeight;const e=this;window.setInterval(a,20);window.addEventListener("resize",a)};this.canCollapse=()=>this.selected().some(a=>a.canCollapse());this.collapse=()=>{this.canCollapse()&&this.undoable(()=>{this.selected().filter(a=>a.canCollapse()).forEach(a=>a.collapsed=!0)})};this.canExpand=()=>this.selected().some(a=>a.canExpand());this.expand=()=>{this.canExpand()&&this.undoable(()=>{this.selected().filter(a=>a.canExpand()).forEach(a=>a.collapsed=
!1)})};this.canMark=()=>this.isMarking&&this.hasSelected();this.mark=()=>{this.canMark()&&this.undoable(()=>{this.selected().forEach(a=>a.marked=!a.marked)})};this.displayCenter=()=>this.displaySize().divide(2);this.toDisplayPos=a=>a.plus(this.displayCenter());this.mouseToModelPos=a=>{const b=this.mm.getBoundingClientRect();return(new d(a.clientX-b.left,a.clientY-b.top)).divide(this.scale).minus(this.displayCenter())};this.changed=a=>{this.redraw(a);this.updateButtons();this.onChanged(this)};this.redraw=
a=>{this.displaySize().toSize(this.mm);a||this.mm.classList.add("no-animation");this.ideas().forEach(a=>a.updateShadow());this.ideas().filter(a=>a.dirty).forEach(a=>a.computeSizes());this.layoutAll(!1);this.ideas().forEach(a=>a.drawElement());a||window.setTimeout(()=>this.mm.classList.remove("no-animation"),0)};this.selected=()=>this.ideas().filter(a=>a.selected&&!a.isHidden());this.hasSelected=()=>0<this.selected().length;this.isOneSelected=()=>1==this.selected().length;this.deselectAll=()=>this.selected().forEach(a=>
a.selected=!1);this.canLayout=()=>0<this.ideas().length;this.layout=a=>{this.canLayout&&this.undoable(()=>this.hasSelected()?this.selected().forEach(b=>b.layout(a)):this.layoutAll(a))};this.layoutAll=a=>this.ideas().filter(a=>1==a.level()).forEach(b=>b.layout(a));this.moveRootIdeas=a=>this.ideas().filter(a=>1==a.level()).forEach(b=>b.move(a));this.canRemove=()=>this.isEditing&&this.hasSelected();this.removeSelected=()=>{this.canRemove()&&this.undoable(()=>{const a=this.isOneSelected()?this.selected()[0].parent():
void 0;this.selected().forEach(a=>a.thisAndDescendants().map(a=>this.remove(a.id)));a&&(a.selected=!0,a.scrollIntoView())})};this.canAddSibling=()=>this.isEditing&&this.isOneSelected()&&1<this.selected()[0].level();this.addSibling=()=>{this.canAddSibling&&this.undoable(()=>{this.blur();var a=this.selected()[0];this.deselectAll();a=this.add(this.createModel(this.nextId(),a.parentId,"","",new d(a.pos.x,a.pos.y+1),!0));a.updateShadow();a.computeSizes();a.drawElement();window.setTimeout(a.edit,0)})};
this.canAddChild=()=>this.isEditing&&(this.isOneSelected()||0==this.ideas().length);this.addChild=()=>{this.canAddChild&&this.undoable(()=>{this.blur();if(this.hasSelected()){var a=this.selected()[0];a.collapsed=!1;this.deselectAll();a=this.add(this.createModel(this.nextId(),a.id,"","",new d(0,0),!0));a.updateShadow();a.computeSizes();a.drawElement();window.setTimeout(a.edit,0)}else a=this.add(this.createModel(this.nextId(),0,"","",new d(0,0),!0)),window.setTimeout(a.edit,0)})};this.blur=()=>{const a=
document.activeElement;a instanceof HTMLSpanElement&&a.parentElement instanceof HTMLDivElement&&this.ideasByElement.get(a.parentElement)&&a.blur()};this.nextId=()=>Math.max(...this.ideas().map(a=>a.id))+1;this.onIdeaDo=(a,b)=>{(a=this.findIdeaByNode(a))&&b(a)};this.findIdeaByNode=a=>{if(a instanceof HTMLDivElement&&a.parentElement==this.mm)return this.ideasByElement.get(a);if(a!=this.mm&&a instanceof HTMLElement)return this.findIdeaByNode(a.parentElement)};this.turnWheel=a=>{if(!this.forceCtrlForWheel||
a.ctrlKey){a.preventDefault();const b=this.scale*(1+(0<a.deltaY?-.1:.1));a=this.mouseToModelPos(a);a=a.divide(b/this.scale).minus(a);this.moveRootIdeas(a);this.updateScale(b)}};this.forceCtrlForWheel=!0;this.moveAround=a=>{const b=new u(this.mm,a);b.drag=a=>{this.moveRootIdeas(a.minus(b.lastPos).divide(this.scale));this.redraw(!1)};b.stopDrag=()=>this.changed(!1);b.start()};this.moveIdea=(a,b)=>{const c=b.element.cloneNode(!0);c.classList.add("drag-image");const e=new u(this.mm,a);e.startDrag=()=>
{b.element.classList.add("dragging");this.mm.appendChild(c)};e.stopDrag=()=>{this.mm.removeChild(c);b.element.classList.remove("dragging")};e.drag=a=>b.elementPos().plus(a.minus(e.startPos).divide(this.scale)).toPosition(c);e.drop=a=>{this.undoable(()=>{function c(a){a.forEach(a=>a.pos=new d(-a.pos.x,a.pos.y))}var f=b.isLeft();const h=this.findIdeaByNode(a.target);if(h){var k=this.mouseToModelPos(a);(1==h.level()&&f!=h.absPos().x>k.x||1!=h.level()&&h.isLeft()!=f)&&c(b.thisAndDescendants());f=h.thisAndAncestors();
k=f.indexOf(b);0<k&&(f[k-1].parentId=b.parentId);b.parentId=h.id}else b.move((new d(a.clientX,a.clientY)).minus(e.startPos).divide(this.scale)),b.isLeft()!=f&&c(b.descendants())})};e.start()};this.toSvgPath=(a,b,c)=>this.toCurvedSvgPath(b,c);this.toCurvedSvgPath=(a,b)=>`M ${a.x} ${a.y} C ${a.x+(b.x-a.x)/1.5} ${a.y} ${b.x-(b.x-a.x)/2} ${b.y} ${b.x} ${b.y}`;this.container=g;this.container.tabIndex=0;this.mm=document.createElement("div");this.mm.className="tmm";this.container.appendChild(this.mm);this.svg=
document.createElementNS("http://www.w3.org/2000/svg","svg");this.mm.appendChild(this.svg);this.shadow=document.createElement("div");this.shadow.className="tmm shadow";this.container.appendChild(this.shadow);g.addEventListener("mousedown",a=>{if(0==a.button&&!(a.ctrlKey||a.shiftKey||a.altKey||a.metaKey))if(a.target==this.mm)this.moveAround(a);else this.onIdeaDo(a.target,b=>this.moveIdea(a,b))});g.addEventListener("wheel",this.turnWheel);g.addEventListener("keydown",a=>{!(a.target!=this.container||
a.shiftKey||a.ctrlKey||a.altKey||a.metaKey)&&0<=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"," "].indexOf(a.key)&&a.preventDefault()});g.addEventListener("keyup",a=>{if(!a.altKey&&!a.metaKey)if(a.ctrlKey)"z"==a.key&&this.undo(),"Z"==a.key&&this.redo()," "==a.key&&this.mark();else if("+"==a.key&&this.scaleUp(),"-"==a.key&&this.scaleDown(),"<"==a.key&&this.collapse(),">"==a.key&&this.expand(),"l"==a.key&&this.layout(!0),"f"==a.key&&this.fitToContainer(),"Delete"==a.key&&this.removeSelected(),"Enter"==
a.key&&this.addSibling(),"Insert"==a.key&&this.addChild(),!a.shiftKey&&this.isOneSelected()){const b=this.selected()[0];" "==a.key&&this.isEditing&&b.edit();"ArrowUp"==a.key&&b.arrowUp();"ArrowDown"==a.key&&b.arrowDown();"ArrowLeft"==a.key&&b.arrowLeft();"ArrowRight"==a.key&&b.arrowRight()}});g.addEventListener("dblclick",a=>this.onIdeaDo(a.target,a=>a.edit()));g.addEventListener("click",a=>{if(0==a.button)if(a.target==this.mm)this.deselectAll(),this.changed(!1);else this.onIdeaDo(a.target,b=>{a.ctrlKey?
(b.selected=!b.selected,this.changed(!0)):b.selectOnly()})});this.updateScale(parseFloat(window.localStorage.getItem("tmm.scale")||"1"));this.initResizeObserver()}}q.MindMap=r;class t{constructor(g){this.parentId=this.id=0;this.key=this.title="";this.pos=new d(0,0);this.collapsed=this.marked=this.selected=!1;this.dirty=!0;this.marginBottom=this.marginTop=this.marginRight=this.marginLeft=this.height=this.width=0;this.connectionOffsets=[];this.parent=()=>this.id==this.parentId?void 0:this.mindMap.ideasMap.get(this.parentId);
this.level=()=>this.parent()?this.parent().level()+1:1;this.isHidden=()=>this.parent()?this.parent().isHidden()||this.parent().isCollapsed():!1;this.isCollapsed=()=>this.collapsed;this.isLeft=()=>2==this.level()?0>this.pos.x:this.parent()?this.parent().isLeft():!1;this.canCollapse=()=>!this.collapsed&&0<this.children().length;this.canExpand=()=>this.collapsed&&0<this.children().length;this.children=()=>this.mindMap.ideas().filter(a=>a.parentId===this.id);this.thisAndAncestors=()=>1<this.level()?[this].concat(this.parent().thisAndAncestors()):
[this];this.thisAndDescendants=()=>{const a=[this];this.children().forEach(b=>a.push(...b.thisAndDescendants()));return a};this.descendants=()=>{const a=this.thisAndDescendants();a.shift();return a};this.absPos=()=>this.parent()?this.parent().absPos().plus(this.isHidden()?new d(0,0):this.pos):this.pos;this.elementPos=()=>this.mindMap.toDisplayPos(this.rect().leftTop().minus(new d(this.marginLeft,this.marginTop)));this.rect=()=>this.absPos().minus(new d(this.width/2,this.height/2)).toRect(this.width,
this.height);this.connectionPoints=()=>this.connectionOffsets.map(a=>this.absPos().plus(a));this.update=a=>{this.id=a.id;this.parentId=a.parentId;this.title=a.title;this.key=a.key;this.pos=new d(a.x,a.y);this.selected=a.selected;this.marked=a.marked;this.collapsed=a.collapsed};this.toModel=()=>({id:this.id,parentId:this.parentId,title:this.title,key:this.key,x:this.pos.x,y:this.pos.y,selected:this.selected,marked:this.marked,collapsed:this.collapsed});this.remove=()=>{this.mindMap.ideasByShadow.delete(this.shadow);
this.mindMap.ideasByElement.delete(this.element);this.mindMap.mm.removeChild(this.element);this.mindMap.shadow.removeChild(this.shadow);this.pathOption&&this.mindMap.svg.removeChild(this.pathOption)};this.updateShadow=()=>{this.shadow.classList.contains(`l${this.level()}`)||(this.dirty=!0,this.shadow.className=`l${this.level()}`);this.titleElement.isContentEditable||this.titleShadow.innerHTML==this.title||(this.dirty=!0,this.titleShadow.innerHTML=this.title);this.toggleClasses(this.shadow)};this.computeSizes=
()=>{this.dirty=!1;const a=window.getComputedStyle(this.shadow);this.marginLeft=parseInt(a.marginLeft||"0",10);this.marginTop=parseInt(a.marginTop||"0",10);this.marginBottom=parseInt(a.marginBottom||"0",10);this.marginRight=parseInt(a.marginRight||"0",10);this.width=parseInt(a.width||"0",10);this.height=parseInt(a.height||"0",10);this.connectionOffsets=this.connectionElements.map(a=>{const b=window.getComputedStyle(a);return new d(this.toInt(b.left,a.offsetLeft)+this.toInt(b.width,a.offsetWidth)/
2-this.width/2,this.toInt(b.top,a.offsetTop)+this.toInt(b.height,a.offsetHeight)/2-this.height/2)})};this.toInt=(a,b)=>parseInt(a||"",10)||b;this.layout=a=>1==this.level()?(this.doLayout(a,this.children().filter(a=>a.isLeft()),!0),this.doLayout(a,this.children().filter(a=>!a.isLeft()),!1),this.rect()):this.doLayout(a,this.children(),this.isLeft());this.doLayout=(a,b,c)=>{function e(a,b){a.idea.move(new d(0,b));a.rect=a.rect.plus(new d(0,b));return a.rect}function g(a,b,c,d){if(1==a.length)a=a[0],
a.rect.top<b?e(a,b-a.rect.top):a.rect.bottom>c&&e(a,-(a.rect.bottom-c)),l=l.union(a.rect);else if(1<a.length){const k=a.shift(),f=a.pop(),n=k.rect.top<b?b:k.rect.top;k.rect.top<b&&e(k,b-k.rect.top);const m=f.rect.bottom>c?c:f.rect.bottom;f.rect.bottom>c&&e(f,-(f.rect.bottom-c));var h=m-n;if(d>h){b=n-b;c-=m;let p=-(d-h);h=d-h;0==b&&0==c?(p/=2,h/=2):(p*=b/(b+c),h*=c/(b+c));e(k,p);e(f,h);l=l.union(k.rect).union(f.rect);g(a,n+k.rect.height+p,m-f.rect.height+h,d-k.rect.height-f.rect.height)}else l=l.union(k.rect).union(f.rect),
g(a,n+k.rect.height,m-f.rect.height,d-k.rect.height-f.rect.height)}}let l=c?new m(this.rect().left,this.rect().top-this.marginTop,this.rect().width+this.marginRight,this.rect().height+this.marginTop):new m(this.rect().left-this.marginLeft,this.rect().top-this.marginTop,this.rect().width+this.marginLeft,this.rect().height+this.marginTop);if(!this.isCollapsed()&&0<b.length){b=b.map(b=>{const e=b.layout(a),f=c?a||this.rect().left<e.right?new d(this.rect().left-e.right,0):new d(0,0):a||this.rect().right>
e.left?new d(this.rect().right-e.left,0):new d(0,0);b.move(f);return{idea:b,rect:e.plus(f)}}).sort((a,b)=>a.idea.pos.y-b.idea.pos.y);const f=b.map(a=>a.rect.height).reduce((a,b)=>a+b,0);if(a){let a=this.absPos().y-(f-b[0].idea.marginTop)/2;b.forEach(b=>{l=l.union(e(b,a-b.rect.top-b.idea.marginTop));a+=b.rect.height})}else g(b,b[0].rect.top,b[b.length-1].rect.bottom,f)}return l};this.toggleClasses=a=>{a.classList.toggle("marked",this.marked);a.classList.toggle("selected",this.selected);a.classList.toggle("collapsed",
this.collapsed)};this.drawElement=()=>{this.elementPos().toPosition(this.element);(new d(this.width,this.height)).toSize(this.element);this.element.classList.contains(`l${this.level()}`)||(this.element.className=`l${this.level()}`);this.element.classList.toggle("hidden",this.isHidden());this.toggleClasses(this.element);this.titleElement.isContentEditable||this.titleElement.innerHTML==this.title||(this.titleElement.innerHTML=this.title);if(1<this.level()){var a=this.parent().connectionPoints();const b=
this.connectionPoints();let c=a[0],e=b[0],d=c.distance(e);for(const g of a)for(const f of b)a=g.distance(f),a<d&&(d=a,c=g,e=f);this.path().setAttributeNS(null,"d",this.mindMap.toSvgPath(this.level(),this.mindMap.toDisplayPos(e),this.mindMap.toDisplayPos(c)));this.path().classList.toggle("hidden",this.isHidden())}else this.pathOption&&(this.mindMap.svg.removeChild(this.pathOption),this.pathOption=void 0)};this.path=()=>this.pathOption||this.initPath();this.pathOption=void 0;this.initPath=()=>{const a=
document.createElementNS("http://www.w3.org/2000/svg","path");this.mindMap.svg.appendChild(a);return this.pathOption=a};this.move=a=>this.pos=this.pos.plus(a);this.snapshot=[];this.edit=()=>{this.mindMap.isEditing&&"true"!=this.titleElement.contentEditable&&(this.titleElement.contentEditable="true",this.scrollIntoView(),this.snapshot=this.mindMap.toModels(),this.mindMap.redraw(!0),this.titleElement.focus())};this.scrollIntoView=()=>{const a=this.rect(),b=this.mindMap.displayCenter();let c=0,e=0;a.right+
this.marginRight>b.x&&(c=b.x-(a.right+this.marginRight));a.left-this.marginLeft<-b.x&&(c=-b.x-(a.left-this.marginLeft));a.bottom+this.marginBottom>b.y&&(e=b.y-(a.bottom+this.marginBottom));a.top-this.marginTop<-b.y&&(e=-b.y-(a.top-this.marginTop));return 0!=c||0!=e?(this.mindMap.moveRootIdeas(new d(c,e)),!0):!1};this.arrowUp=()=>this.previousSibling()?this.previousSibling().selectOnly():this.arrow((a,b)=>a.y<b.y);this.arrowDown=()=>this.nextSibling()?this.nextSibling().selectOnly():this.arrow((a,
b)=>a.y>b.y);this.previousSibling=()=>this.siblings().filter(a=>a.isLeft()==this.isLeft()&&a.pos.y<this.pos.y).reverse()[0];this.nextSibling=()=>this.siblings().filter(a=>a.isLeft()==this.isLeft()&&a.pos.y>this.pos.y)[0];this.siblings=()=>this.parent()?this.parent().children().filter(a=>a!=this).sort((a,b)=>a.pos.y-b.pos.y):[];this.arrowLeft=()=>1==this.level()||this.isLeft()?this.childOrNearest(this.leftChildren(),(a,b)=>a.x<b.x):this.parent().selectOnly();this.arrowRight=()=>1!=this.level()&&this.isLeft()?
this.parent().selectOnly():this.childOrNearest(this.rightChildren(),(a,b)=>a.x>b.x);this.leftChildren=()=>this.children().filter(a=>!a.isHidden()).filter(a=>a.absPos().x<this.absPos().x);this.rightChildren=()=>this.children().filter(a=>!a.isHidden()).filter(a=>a.absPos().x>this.absPos().x);this.childOrNearest=(a,b)=>0<a.length?this.findNearest(a).selectOnly():this.arrow(b);this.arrow=a=>{const b=this.findNearest(this.mindMap.ideas().filter(a=>!a.isHidden()).filter(b=>a(b.absPos(),this.absPos())));
b&&b.selectOnly()};this.findNearest=a=>(a=a.map(a=>({idea:a,distance:this.absPos().distance(a.absPos())})).sort((a,c)=>a.distance-c.distance)[0])?a.idea:void 0;this.selectOnly=()=>{this.mindMap.deselectAll();this.selected=!0;this.scrollIntoView();this.mindMap.changed(!0)};this.mindMap=g;this.element=document.createElement("div");this.titleElement=document.createElement("span");this.element.appendChild(this.titleElement);this.mindMap.mm.appendChild(this.element);this.mindMap.ideasByElement.set(this.element,
this);this.shadow=document.createElement("div");this.titleShadow=document.createElement("span");this.shadow.appendChild(this.titleShadow);this.connectionElements=[1,2].map(a=>{const b=document.createElement("i");b.classList.add(`p${a}`);this.shadow.appendChild(b);return b});this.mindMap.shadow.appendChild(this.shadow);this.mindMap.ideasByShadow.set(this.shadow,this);this.titleElement.addEventListener("keydown",a=>"Enter"==a.key&&!a.shiftKey&&!a.ctrlKey&&!a.altKey&&!a.metaKey&&a.preventDefault());
this.titleElement.addEventListener("keyup",a=>{a.stopPropagation();"Enter"!=a.key||a.shiftKey||a.ctrlKey||a.altKey||a.metaKey?"Escape"!=a.key||a.shiftKey||a.ctrlKey||a.altKey||a.metaKey||(a.preventDefault(),this.titleElement.innerHTML=this.title,this.mindMap.container.focus()):(a.preventDefault(),this.mindMap.container.focus())});this.titleElement.addEventListener("input",()=>{this.titleShadow.innerHTML=this.titleElement.innerHTML;this.dirty=!0;this.mindMap.redraw(!1)});this.titleElement.addEventListener("focusin",
()=>{this.mindMap.mm.scrollTop=0;this.mindMap.mm.scrollLeft=0;window.setTimeout(()=>this.mindMap.mm.classList.add("title-focused"),500)});this.titleElement.addEventListener("focusout",()=>{this.mindMap.mm.classList.remove("title-focused");this.titleElement.contentEditable="false";this.title!=this.titleElement.innerHTML?(this.title=this.titleElement.innerHTML,this.mindMap.storeUndoRedo(this.snapshot)):this.snapshot.forEach(a=>this.mindMap.ideasMap.get(a.id).update(a));this.mindMap.changed(!0)})}}q.Idea=
t;const v=new Map;q.init=function(d){if(null==d)throw"Element must not be null";var a=v.get(d);if(a)return a;a=new r(d);v.set(d,a);return a};class u{constructor(g,a){this.dragging=!1;this.minDistance=4;this.keyUp=a=>{"Escape"==a.key&&this.stop()};this.mouseUp=a=>{this.stop();this.dragging&&this.drop(a)};this.click=a=>{this.dragging&&(a.preventDefault(),a.stopPropagation())};this.mouseMove=a=>{a=new d(a.clientX,a.clientY);const b=a.minus(this.startPos);!this.dragging&&b.length()>this.minDistance&&
(this.dragging=!0,this.container.classList.add("dragging"),this.startDrag());this.dragging&&(this.drag(a),this.lastPos=a)};this.start=()=>{document.addEventListener("click",this.click,!0);this.container.addEventListener("mouseup",this.mouseUp);this.container.addEventListener("mousemove",this.mouseMove);document.addEventListener("mouseup",this.stop);document.addEventListener("keyup",this.keyUp)};this.stop=()=>{this.dragging&&(this.stopDrag(),this.container.classList.remove("dragging"));window.setTimeout(()=>
document.removeEventListener("click",this.click,!0),0);this.container.removeEventListener("mousemove",this.mouseMove);this.container.removeEventListener("mouseup",this.mouseUp);document.removeEventListener("mouseup",this.stop);document.removeEventListener("keyup",this.keyUp)};this.startDrag=()=>{};this.drag=a=>{};this.drop=a=>{};this.stopDrag=()=>{};this.container=g;this.startEvent=a;this.lastPos=this.startPos=new d(this.startEvent.clientX,this.startEvent.clientY)}}class d{constructor(g,a){this.distance=
a=>Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2));this.length=()=>this.distance(new d(0,0));this.minus=a=>new d(this.x-a.x,this.y-a.y);this.divide=a=>new d(this.x/a,this.y/a);this.plus=a=>new d(this.x+a.x,this.y+a.y);this.toPosition=a=>{const b=this.x+"px",e=this.y+"px";a.style.left!=b&&(a.style.left=b);a.style.top!=e&&(a.style.top=e)};this.toSize=a=>{const b=this.x+"px",e=this.y+"px";a.style.width!=b&&(a.style.width=b);a.style.height!=e&&(a.style.height=e)};this.toRect=(a,c)=>new m(this.x,
this.y,a,c);this.x=g;this.y=a}}class m{constructor(g,a,b,c){this.union=a=>{const b=Math.min(this.left,a.left),c=Math.min(this.top,a.top);return new m(b,c,Math.max(this.right,a.right)-b,Math.max(this.bottom,a.bottom)-c)};this.minus=a=>new m(this.left-a.x,this.top-a.y,this.width,this.height);this.plus=a=>new m(this.left+a.x,this.top+a.y,this.width,this.height);this.divide=a=>new m(this.left/a,this.top/a,this.width/a,this.height/a);this.leftTop=()=>new d(this.left,this.top);this.left=g;this.top=a;this.width=
b;this.height=c;this.center=new d(this.left+this.width/2,this.top+this.height/2);this.right=this.left+this.width;this.bottom=this.top+this.height}}})(TwibsMindMaps||(TwibsMindMaps={}));
